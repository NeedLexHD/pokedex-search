<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Recherche Pokédex FR</title>
<style>
body {
  font-family: Arial, sans-serif;
}

.search-container {
  position: relative;
  width: 320px;
  margin: 20px auto;
}

#search {
  width: 100%;
  padding: 10px 40px 10px 12px;
  font-size: 16px;
  border-radius: 20px;
  border: 1px solid #aaa;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#search:focus {
  outline: none;
  border-color: #ffcb05;
  box-shadow: 0 0 5px rgba(255,203,5,0.6);
}

#search-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 18px;
  color: #888;
  pointer-events: none;
}

#suggestions {
  width: 100%;
  border: 1px solid #ccc;
  background: white;
  position: absolute;
  top: 100%;
  left: 0;
  border-radius: 0 0 15px 15px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  z-index: 9999;
}

.suggestion {
  padding: 6px 10px;
  cursor: pointer;
  font-size: 15px;
  transition: background 0.2s;
}

.suggestion:hover {
  background: #f2f2f2;
}

#loading {
  text-align: center;
  font-size: 14px;
  color: #555;
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="search-container">
  <input type="text" id="search" placeholder="Rechercher un Pokémon..." autocomplete="off" disabled>
  <span id="search-icon">&#128269;</span>
  <div id="suggestions"></div>
</div>
<div id="loading">Chargement de la liste des Pokémon...</div>

<script>
// Fonction de normalisation
function normalize(str) {
  if (!str) return "";
  return String(str).toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");
}

let pokemonList = [];
let isLoaded = false;
const input = document.getElementById("search");
const container = document.getElementById("suggestions");
const loadingDiv = document.getElementById("loading");

// Charger le JSON depuis GitHub Pages
fetch("https://NeedLexHD.github.io/pokedex-search/pokemon.json")
  .then(res => res.json())
  .then(data => {
    // Transforme chaque Pokémon pour garder id, num et name.fr
    pokemonList = data.map(p => ({
      id: p.id,
      num: p.num,
      name: p.name.fr
    }));
    isLoaded = true;
    input.disabled = false;  // Activer la barre de recherche
    loadingDiv.style.display = "none";
    console.log("Liste des Pokémon chargée !");
  })
  .catch(err => console.error("Erreur JSON:", err));

// Événement input
input.addEventListener("input", () => {
  if (!isLoaded) return;

  const q = normalize(input.value);
  container.innerHTML = "";
  if (q.length === 0) return;

  const results = pokemonList.filter(p =>
    normalize(p.name).startsWith(q) ||
    normalize(p.num).startsWith(q)
  ).slice(0, 10);

  results.forEach(p => {
    const div = document.createElement("div");
    div.className = "suggestion";
    div.textContent = `${p.num} ${p.name}`;
    div.onclick = () => openPokemon(p);
    container.appendChild(div);
  });
});

// Redirection vers Google Sites
function openPokemon(p) {
  const num = p.num;
  const nameSlug = encodeURIComponent(normalize(p.name));
  const n = p.id;

  // Tranches de 49 Pokémon
  const start = Math.floor((n - 1) / 49) * 49 + 1;
  let end = start + 48;
  if (end > 1025) end = 1025;

  const startStr = String(start).padStart(3, '0');
  const endStr = String(end).padStart(3, '0');

  const folder = `pokedex-${startStr}-${endStr}`;
  const url = `https://sites.google.com/view/lex3d/${folder}/${num}-${nameSlug}`;

  console.log("Redirection vers :", url);
  window.location.href = url;
}
</script>

</body>
</html>
