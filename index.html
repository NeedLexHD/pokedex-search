<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Recherche Pokédex FR</title>
<style>
body {
  font-family: Arial, sans-serif;
}

.search-container {
  position: relative;
  width: 320px;
  margin: 20px auto;
}

#search {
  width: 100%;
  padding: 10px 40px 10px 12px;
  font-size: 16px;
  border-radius: 20px;
  border: 1px solid #aaa;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#search:focus {
  outline: none;
  border-color: #ffcb05;
  box-shadow: 0 0 5px rgba(255,203,5,0.6);
}

#search-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 18px;
  color: #888;
  pointer-events: none;
}

#suggestions {
  width: 100%;
  border: 1px solid #ccc;
  background: white;
  position: absolute;
  top: 100%;
  left: 0;
  border-radius: 0 0 15px 15px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  z-index: 9999;
}

.suggestion {
  padding: 6px 10px;
  cursor: pointer;
  font-size: 15px;
  transition: background 0.2s;
}

.suggestion:hover {
  background: #f2f2f2;
}
</style>
</head>
<body>

<div class="search-container">
  <input type="text" id="search" placeholder="Rechercher un Pokémon..." autocomplete="off">
  <span id="search-icon">&#128269;</span>
  <div id="suggestions"></div>
</div>

<script>
// Initialisation d'un tableau vide pour stocker les Pokémon
let pokemonList = [];

// Fonction pour récupérer les Pokémon depuis l'API Tyradex
fetch("https://tyradex.app/api/v1/pokemon")
  .then(res => res.json())
  .then(data => {
    // Une fois les données récupérées, on les ajoute à notre tableau pokemonList
    pokemonList = data.map(p => ({
      id: p.id,
      num: String(p.id).padStart(3, "0"),
      name: p.name   // nom français
    }));
  })
  .catch(err => console.error("Erreur Tyradex:", err));

// Fonction pour normaliser les caractères (enlever les accents)
function normalize(str) {
  if (typeof str !== 'string') {
    return ''; // Si ce n'est pas une chaîne, on retourne une chaîne vide
  }
  return str.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");
}

const input = document.getElementById("search");
const container = document.getElementById("suggestions");

input.addEventListener("input", () => {
  const query = normalize(input.value);
  container.innerHTML = "";
  if (query.length === 0) return;

  // Filtrage des Pokémon
  const results = pokemonList.filter(p =>
    normalize(p.name).startsWith(query) ||
    normalize(p.num).startsWith(query)
  ).slice(0, 10);

  // Affichage des suggestions
  results.forEach(p => {
    const div = document.createElement("div");
    div.className = "suggestion";
    div.textContent = `${p.num} ${p.name}`;
    div.onclick = () => openPokemon(p);
    container.appendChild(div);
  });
});

// Fonction de redirection vers la page Pokémon sur Google Sites
function openPokemon(p) {
  const num = p.num;
  const nameSlug = normalize(p.name).replace(/ /g, "-").replace(/'/g, "");
  const url = `https://sites.google.com/view/lex3d/pokedex/${num}-${nameSlug}`;
  window.location.href = url;
}
</script>

</body>
</html>
